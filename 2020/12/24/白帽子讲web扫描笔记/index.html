<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">






<link rel="stylesheet" href="/css/main.css?v=7.2.0">






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="查看几款扫描器的能力http://www.sectoolmarket.com/price-and-feature-comparison-of-web-application-scanners-unified-list.html   使用wavsep项目作为扫描器的靶场也是一个评估   爬取一些请求中的技巧使用 HEAD方法 加快对检测链接或者目录的有效性 因为与GET是一样的除了不会返回响应体 响">
<meta name="keywords" content="源码 读书 安全 开发 Python Java Go">
<meta property="og:type" content="article">
<meta property="og:title" content="白帽子讲web扫描笔记">
<meta property="og:url" content="http://yoursite.com/2020/12/24/白帽子讲web扫描笔记/index.html">
<meta property="og:site_name" content="Recar的笔记">
<meta property="og:description" content="查看几款扫描器的能力http://www.sectoolmarket.com/price-and-feature-comparison-of-web-application-scanners-unified-list.html   使用wavsep项目作为扫描器的靶场也是一个评估   爬取一些请求中的技巧使用 HEAD方法 加快对检测链接或者目录的有效性 因为与GET是一样的除了不会返回响应体 响">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2021-06-11T10:33:06.389Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="白帽子讲web扫描笔记">
<meta name="twitter:description" content="查看几款扫描器的能力http://www.sectoolmarket.com/price-and-feature-comparison-of-web-application-scanners-unified-list.html   使用wavsep项目作为扫描器的靶场也是一个评估   爬取一些请求中的技巧使用 HEAD方法 加快对检测链接或者目录的有效性 因为与GET是一样的除了不会返回响应体 响">





  
  
  <link rel="canonical" href="http://yoursite.com/2020/12/24/白帽子讲web扫描笔记/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  
  <title>白帽子讲web扫描笔记 | Recar的笔记</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f6Wf4b00fa957d7290583a86b0d8c2de1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Recar的笔记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



</div>
    </header>

    
  
  

  

  <a href="https://github.com/Ciyfly" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/24/白帽子讲web扫描笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Recar">
      <meta itemprop="description" content="年轻人就应该多读源码多读书">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Recar的笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">白帽子讲web扫描笔记

              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-12-24 14:29:49" itemprop="dateCreated datePublished" datetime="2020-12-24T14:29:49+00:00">2020-12-24</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-06-11 10:33:06" itemprop="dateModified" datetime="2021-06-11T10:33:06+00:00">2021-06-11</time>
              </span>
            
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>查看几款扫描器的能力<br><a href="http://www.sectoolmarket.com/price-and-feature-comparison-of-web-application-scanners-unified-list.html" target="_blank" rel="noopener">http://www.sectoolmarket.com/price-and-feature-comparison-of-web-application-scanners-unified-list.html</a>  </p>
<p>使用wavsep项目作为扫描器的靶场也是一个评估  </p>
<h2 id="爬取"><a href="#爬取" class="headerlink" title="爬取"></a>爬取</h2><h3 id="一些请求中的技巧"><a href="#一些请求中的技巧" class="headerlink" title="一些请求中的技巧"></a>一些请求中的技巧</h3><p>使用 HEAD方法 加快对检测链接或者目录的有效性 因为与GET是一样的<br>除了不会返回响应体 响应体不返回就会节约很多时间  </p>
<p>对于页面url的爬取不能单纯采用深度和广度爬取<br>我们需要对页面的url先进行评估 是一种启发式的爬取<br>最多的还是广度优先遍历和 追加优先策略  </p>
<p>URL 有相似的这个概念即 ID=1 ID=2这种的 参数名参数个数  </p>
<p>还有URL包含 参数的多少包含关系 这种要注意  </p>
<p>页面相似算法 编辑距离和Simhash  </p>
<p>要注意断连重试  </p>
<p>他对每个url解析了解析成字典<br>还封装了一个返回请求字符串的  </p>
<p>对requests进行了二次封装  比如请求头啊什么的响应呀的  </p>
<h3 id="使用DNS缓存优化"><a href="#使用DNS缓存优化" class="headerlink" title="使用DNS缓存优化"></a>使用DNS缓存优化</h3><p>这里还对dns的使用进行了优化<br>如果 该域名已经被查询过 那么直接返回dns查询结果 否则  </p>
<p>网上看还是有用的我们试试  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">_dnscache=&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_setDNSCache</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Makes a cached version of socket._getaddrinfo to avoid subsequent DNS requests.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_getaddrinfo</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">global</span> _dnscache</span><br><span class="line">        <span class="keyword">if</span> args <span class="keyword">in</span> _dnscache:</span><br><span class="line">            <span class="keyword">print</span> str(args)+<span class="string">" in cache"</span></span><br><span class="line">            <span class="keyword">return</span> _dnscache[args]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> str(args)+<span class="string">" not in cache"</span>  </span><br><span class="line">            _dnscache[args] = socket._getaddrinfo(*args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> _dnscache[args]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> hasattr(socket, <span class="string">'_getaddrinfo'</span>):</span><br><span class="line">        socket._getaddrinfo = socket.getaddrinfo</span><br><span class="line">        socket.getaddrinfo = _getaddrinfo</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">	_setDNSCache()</span><br><span class="line">	<span class="keyword">import</span> urllib</span><br><span class="line">	urllib.urlopen(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">	urllib.urlopen(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line"></span><br><span class="line">test()</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">代码</span><br><span class="line">```python</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="comment"># from gevent import socket</span></span><br><span class="line">_dnscache = &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_setDNSCache</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="string">""" DNS缓存 """</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_getaddrinfo</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> args <span class="keyword">in</span> _dnscache:</span><br><span class="line">      <span class="comment"># print str(args) + " in cache"</span></span><br><span class="line">      <span class="keyword">return</span> _dnscache[args]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="comment"># print str(args) + " not in cache"</span></span><br><span class="line">      _dnscache[args] = socket._getaddrinfo(*args, **kwargs)</span><br><span class="line">      <span class="keyword">return</span> _dnscache[args]</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> hasattr(socket, <span class="string">'_getaddrinfo'</span>):</span><br><span class="line">    socket._getaddrinfo = socket.getaddrinfo</span><br><span class="line">    socket.getaddrinfo = _getaddrinfo</span><br></pre></td></tr></table></figure>

<p>可以将上面的代码放在一个dns_cache.py文件里，爬虫框架里调用一下这个_setDNSCache()方法就行了。  </p>
<p>其实Windows本身是有DNS缓存机制的，访问一个域名后，系统会缓存下域名对应的IP。我们的爬虫通常是运行在Linux上的，Linux本身一般是没有DNS缓存的。  </p>
<h3 id="第三方库管理dns缓存加快速度"><a href="#第三方库管理dns缓存加快速度" class="headerlink" title="第三方库管理dns缓存加快速度"></a>第三方库管理dns缓存加快速度</h3><p><a href="https://github.com/s0md3v/velocity" target="_blank" rel="noopener">https://github.com/s0md3v/velocity</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> velocity</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">     requests.get(<span class="string">'https://s0md3v.github.io'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重要：如果使用线程，请考虑手动缓存主机名，以防止数据库受到竞争条件的影响</span></span><br></pre></td></tr></table></figure>

<p>这个代码真滴low  </p>
<h3 id="布隆过滤器-BloomFilter"><a href="#布隆过滤器-BloomFilter" class="headerlink" title="布隆过滤器 BloomFilter"></a>布隆过滤器 BloomFilter</h3><p>这里讲了下布隆过滤器 BloomFilter<br>就是说这个方法就是说 我现在有三个元素 x,y,z<br>有三个hash函数 a,b,c<br>把x过a,b,c 然后看对应位置上<br>如果a,b,c三个函数的值就是位置都是1 则可能存在否则一定不存在<br>是存在一定的误判的 是可能存在 一定不存在<br>python使用的话  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bloom_filter <span class="keyword">import</span> BloomFilter</span><br><span class="line"><span class="comment"># 生成一个装1亿大小的</span></span><br><span class="line">bloombloom = BloomFilter(max_elements=<span class="number">100000000</span>, error_rate=<span class="number">0.1</span>)</span><br><span class="line"><span class="comment"># 向bloom添加URL</span></span><br><span class="line">bloom.add(<span class="string">'https://www.tianyancha.com/company/23402373'</span>)</span><br><span class="line"><span class="comment">#判断URL是否在</span></span><br><span class="line">bloombloom.__contains__(<span class="string">'https://www.tianyancha.com/company/23402373'</span>)</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"><span class="comment">### 使用adsl拨号更换ip比ip代理池更便宜  </span></span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">windows下用os调用rasdial拨号：</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># 拨号断开</span></span><br><span class="line">os.popen(<span class="string">'rasdial 网络链接名称 /disconnect'</span>)</span><br><span class="line"><span class="comment"># 拨号</span></span><br><span class="line">os.popen(<span class="string">'rasdial 网络链接名称 adsl账号 adsl密码'</span>)</span><br><span class="line"></span><br><span class="line">linux下拨号：</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># 拨号断开</span></span><br><span class="line">code = os.system(<span class="string">'ifdown 网络链接名称'</span>)</span><br><span class="line"><span class="comment"># 拨号</span></span><br><span class="line">code = os.system(<span class="string">'ifup 网络链接名称'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="线程是怎么选择的具体多少呢"><a href="#线程是怎么选择的具体多少呢" class="headerlink" title="线程是怎么选择的具体多少呢"></a>线程是怎么选择的具体多少呢</h3><p>需要我们测试 从一个线程到多个线程<br>线程个数、总抓取次数、抓取成功次数、耗时  </p>
<p>从这几个角度测试比较找到最优</p>
<h3 id="requests请求优化"><a href="#requests请求优化" class="headerlink" title="requests请求优化"></a>requests请求优化</h3><p>要优化requests.get(timeout=1.5)的超时时间<br>1.5s比10s好多了 实在不行了还可以重试  </p>
<h3 id="为什么不使用异步"><a href="#为什么不使用异步" class="headerlink" title="为什么不使用异步"></a>为什么不使用异步</h3><p>异步是对程序逻辑的的性能 主要问题是网络性能<br>而且爬取太快对网站也有影响  </p>
<h3 id="如何控制速率"><a href="#如何控制速率" class="headerlink" title="如何控制速率"></a>如何控制速率</h3><p>两种方式  </p>
<ol>
<li>通过构建一个队列 启动个线程每次去这个队列里去取出来 控制这个<br>有次面试也说的叫令牌桶的概念  </li>
<li>通过hook socket中的connect函数来在请求发送之前进行时间间隔的统一控制和处理  </li>
</ol>
<p>hook socket的方式是 加载替换 connect方法<br>然后在里面进行 while True的执行 计算时间后break这样  </p>
<h3 id="页面解析"><a href="#页面解析" class="headerlink" title="页面解析"></a>页面解析</h3><p>需要解析几个地方和字段  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">URL_HEADERS = (<span class="string">'location'</span>)</span><br><span class="line">URL_TAGS = (<span class="string">'a'</span>, <span class="string">'img'</span>, <span class="string">'link'</span>, <span class="string">'script'</span>, <span class="string">'iframe'</span>, <span class="string">'frame'</span>, <span class="string">'form'</span>, <span class="string">'object'</span>)</span><br><span class="line">URL_ATTRS = (<span class="string">'href'</span>, <span class="string">'src'</span>, <span class="string">'data'</span>, <span class="string">'action'</span>)</span><br><span class="line">URL_RE = re.compile(<span class="string">'(http|https)://([\w:@\-\./]*?)[^ \n\r\t"\'&lt;&gt;]\s)*)'</span>, re.U|re.I)</span><br><span class="line"><span class="comment"># 先判断 tags 里有没有 attrs的属性 有的话提取</span></span><br></pre></td></tr></table></figure>

<p>三者合一 得到当前页面解析的url  </p>
<h3 id="表单自动提交"><a href="#表单自动提交" class="headerlink" title="表单自动提交"></a>表单自动提交</h3><p>是通过解析到的from后根据表单字段匹配 使用默认的表单内容字段  </p>
<h3 id="URL去重"><a href="#URL去重" class="headerlink" title="URL去重"></a>URL去重</h3><p>1.使用布隆过滤器<br>后面url的长度越来越长 最好是进行固定长度<br>于是这里使用了hash对url进行固定长度</p>
<ol start="2">
<li>hash去重<br>就是用list存储 然后判断 是否in 这个list 当时咱们看过一个对于大型list怎么判断 可以做成字典来去处理  </li>
</ol>
<p>还有相似性的去重<br>主要是对其url进行泛化<br>比如 a=1&amp;b=2&amp;c=3 与 b=1&amp;c=2&amp;a=3<br>其实是一个url 我们就可以对其进行排序+泛化变为 a=@&amp;b=@&amp;c=@ 这种形式  </p>
<h3 id="404页面识别"><a href="#404页面识别" class="headerlink" title="404页面识别"></a>404页面识别</h3><ol>
<li>先构造一些不可能存在的页面 触发404<br>将页面与404页面进行相似度比较  </li>
</ol>
<h3 id="重试"><a href="#重试" class="headerlink" title="重试"></a>重试</h3><p>使用装饰器对请求进行超时重试<br>在装饰器参数中支持重试次数和下次重试时间  </p>
<h3 id="爬虫的限制"><a href="#爬虫的限制" class="headerlink" title="爬虫的限制"></a>爬虫的限制</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 控制爬行的深度</span></span><br><span class="line"><span class="keyword">if</span> depth &gt; self.depth_limit:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"depth limit break"</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"><span class="comment"># 控制爬行的时间</span></span><br><span class="line"><span class="keyword">if</span> self.get_discovery_time() &gt; self.time_limit:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"time limit break"</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制爬行的链接数，避免内存泄露</span></span><br><span class="line"><span class="keyword">if</span> self.num_reqs &gt; self.req_limit:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"reqs num limit break"</span></span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h3 id="web2-0的url获取"><a href="#web2-0的url获取" class="headerlink" title="web2.0的url获取"></a>web2.0的url获取</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CrawlAjax</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="comment"># 存储最终爬取到的所有URL</span></span><br><span class="line">    urls_out = []</span><br><span class="line">    <span class="comment"># 存储临时的URL 待过滤</span></span><br><span class="line">    urls_temp = []</span><br><span class="line">    <span class="comment"># 初始化浏览器引擎 载入当前的URL页面</span></span><br><span class="line">    browser.init()</span><br><span class="line">    page = browser.open(url)</span><br><span class="line">    <span class="comment"># 获取当前页面中需要处理的事情</span></span><br><span class="line">    events = page.get_events()</span><br><span class="line">    <span class="comment"># 获取当前页面中所有的URLS</span></span><br><span class="line">    urls = page.get_urls()</span><br><span class="line">    urls_temp.extends(urls)</span><br><span class="line">    <span class="comment"># 遍历状态深度为1的事件</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> events:</span><br><span class="line">        <span class="comment"># 对事件进行触发</span></span><br><span class="line">        newpage_i = browser.do_event(i)</span><br><span class="line">        <span class="comment"># 获取页面中心的时间</span></span><br><span class="line">        new_events = get_events(new_page, page)</span><br><span class="line">        <span class="comment"># 获取当前页面中所有的URL</span></span><br><span class="line">        urls = newpage_i.get_urls()</span><br><span class="line">        urls_temp.extends(urls)</span><br><span class="line">        <span class="comment"># 遍历状态深度为2的如上 再次for new_events 事件进行操作</span></span><br></pre></td></tr></table></figure>

<p>比如说对a标签进行点击<br>对按钮进行点击<br>a标签获取会重复 使用 href onclick作为属性作为hash<br>这个后续可以读下其他的源码  </p>
<h2 id="指纹识别"><a href="#指纹识别" class="headerlink" title="指纹识别"></a>指纹识别</h2><ol>
<li><p>内容特征 在响应体中</p>
</li>
<li><p>页面特征 有固定页面 可以直接hash判断</p>
</li>
<li><p>Headers特征 独有的报头信息  </p>
</li>
</ol>
<h2 id="安装漏洞审计"><a href="#安装漏洞审计" class="headerlink" title="安装漏洞审计"></a>安装漏洞审计</h2><ol>
<li>需要分析现实现中这个漏洞的各种场景</li>
<li>构造出可以覆盖所有漏洞场景的扫描载荷  </li>
<li>将其转化为扫描器的检查脚本并生成最终的扫描签名  </li>
</ol>
<p>安全漏洞可以分为两类 通用型漏洞 Nday/0day漏洞  </p>
<p>通用型就是 具有普遍性 sql注入、xss、 命令执行等  </p>
<p>Nday/0day就是针对某一个具体应用 poc 直接就能打的  </p>
<p>这些具体的检查可以从单独的扫描器中提取出核心检测当时来操作</p>
<p>几个需要检测的点  </p>
<ol>
<li>sql注入</li>
<li>xss</li>
<li>命令执行</li>
<li>文件包含</li>
<li>信息泄露  (压缩备份文件 git文件泄露等 敏感信息配置文件等 着重)</li>
</ol>
<p>需要注意的是扫描器是进行检验的不是进行攻击的  </p>
<h2 id="扫描器进阶"><a href="#扫描器进阶" class="headerlink" title="扫描器进阶"></a>扫描器进阶</h2><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><ol>
<li>ip信息</li>
<li>子域信息</li>
<li>敏感信息</li>
<li>指纹信息</li>
<li>url信息</li>
</ol>
<p>模块的职责功能需要单一 模块中关联的功能尽可能在同一个模块中实现<br>每个模块只负责一个功能 保证每个功能都是独立 减少依赖  </p>
<h3 id="功能模块"><a href="#功能模块" class="headerlink" title="功能模块"></a>功能模块</h3><ol>
<li>端口模块<br> 端口爆破探测 syn 半连接探测 无状态探测</li>
<li>域名模块<br> 域名接口、证书、爆破</li>
<li>探测模块<br> 路径的爆破 字典、分析后智能构造字典 默认文件路径 根据github开源项目路由解析提取</li>
<li>指纹模块<br> 开源项目 核心在字典和架构、速度</li>
<li>爬虫模块<br> 参考一些开源的实现 基于浏览器做的比较好 可增加被动代理模块 做流量分析而不是 再次探测</li>
<li>漏洞检测模块<br> 通用漏洞和poc</li>
<li>扫描引擎 调度<br> 整体的流程:<pre><code>1.子域名爆破/监控-&gt;2.任务下发到端口-&gt; 拿到大量服务-&gt; 3.爬虫获取url 探测路径 漏洞检测等</code></pre></li>
<li>报告模块<br> 主要是好看 好理解 到底想要什么  </li>
</ol>
<p>注重分层设计  </p>
<h3 id="提升"><a href="#提升" class="headerlink" title="提升"></a>提升</h3><p>拿靶场进行测试 扫描到了后误报进行规避 漏报进行处理  </p>
<h2 id="云扫描"><a href="#云扫描" class="headerlink" title="云扫描"></a>云扫描</h2><p>主要就是多work的形式还有队列加上webUI<br>这么主要是架构方面的变化  </p>
<h2 id="企业安全扫描实践"><a href="#企业安全扫描实践" class="headerlink" title="企业安全扫描实践"></a>企业安全扫描实践</h2><p>基于网络流量的扫描 最普遍以及使用的就是DPDK  </p>
<p>DPDK 对硬件有要求 需要Intel 并且需要至少两个CPU 三个网卡<br>需要源码编译 并且有bug需要手动打补丁后编译<br>安装完成后就可以用dpdk-pdump来捕获网络流量了  </p>
<p>后面可以解析pcap包来判断<br>还有一种是基于访问日志 比如splunk 来处理  </p>
<p>可以给nginx安装个 模块来获取到请求的post数据<br>安装 lua语言  ngx_dev_kit 模块 lua_nginx_moudle模块  </p>
<h2 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h2><ol>
<li>可以在页面标签中加个隐藏的url 访问了就是扫描器  </li>
<li>日志</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>如何让爬虫一天抓取100万张网页<br><a href="https://mp.weixin.qq.com/s?__biz=MjM5NjE0NTY5OA==&amp;mid=2448548659&amp;idx=1&amp;sn=d2a8dd3544bfd7980c8ab1fbb0c5dd4b&amp;chksm=b2e8fc7e859f7568b41fcc55b384e9d78a4c4503707ac34c890a3be17ecfe2d40df4bc3602d5&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MjM5NjE0NTY5OA==&amp;mid=2448548659&amp;idx=1&amp;sn=d2a8dd3544bfd7980c8ab1fbb0c5dd4b&amp;chksm=b2e8fc7e859f7568b41fcc55b384e9d78a4c4503707ac34c890a3be17ecfe2d40df4bc3602d5&amp;scene=21#wechat_redirect</a>  </p>

      
    </div>

    

    
      
    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/12/24/Docker-逃逸了解/" rel="next" title="Docker 逃逸了解">
                <i class="fa fa-chevron-left"></i> Docker 逃逸了解
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/12/24/python排除celery以外两种常见的任务队列/" rel="prev" title="python排除celery以外两种常见的任务队列">
                python排除celery以外两种常见的任务队列 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>

  </div>


          </div>
          
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  
    <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Recar">
  
  <p class="site-author-name" itemprop="name">Recar</p>
  <div class="site-description motion-element" itemprop="description">年轻人就应该多读源码多读书</div>
</div>


  <nav class="site-state motion-element">
    
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    

    

    
      
      
      <div class="site-state-item site-state-tags">
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span>
        
      </div>
    
  </nav>













          
          
        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#爬取"><span class="nav-number">1.</span> <span class="nav-text">爬取</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一些请求中的技巧"><span class="nav-number">1.1.</span> <span class="nav-text">一些请求中的技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用DNS缓存优化"><span class="nav-number">1.2.</span> <span class="nav-text">使用DNS缓存优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第三方库管理dns缓存加快速度"><span class="nav-number">1.3.</span> <span class="nav-text">第三方库管理dns缓存加快速度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#布隆过滤器-BloomFilter"><span class="nav-number">1.4.</span> <span class="nav-text">布隆过滤器 BloomFilter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#线程是怎么选择的具体多少呢"><span class="nav-number">1.5.</span> <span class="nav-text">线程是怎么选择的具体多少呢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#requests请求优化"><span class="nav-number">1.6.</span> <span class="nav-text">requests请求优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为什么不使用异步"><span class="nav-number">1.7.</span> <span class="nav-text">为什么不使用异步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何控制速率"><span class="nav-number">1.8.</span> <span class="nav-text">如何控制速率</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#页面解析"><span class="nav-number">1.9.</span> <span class="nav-text">页面解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#表单自动提交"><span class="nav-number">1.10.</span> <span class="nav-text">表单自动提交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#URL去重"><span class="nav-number">1.11.</span> <span class="nav-text">URL去重</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#404页面识别"><span class="nav-number">1.12.</span> <span class="nav-text">404页面识别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重试"><span class="nav-number">1.13.</span> <span class="nav-text">重试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#爬虫的限制"><span class="nav-number">1.14.</span> <span class="nav-text">爬虫的限制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web2-0的url获取"><span class="nav-number">1.15.</span> <span class="nav-text">web2.0的url获取</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指纹识别"><span class="nav-number">2.</span> <span class="nav-text">指纹识别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装漏洞审计"><span class="nav-number">3.</span> <span class="nav-text">安装漏洞审计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#扫描器进阶"><span class="nav-number">4.</span> <span class="nav-text">扫描器进阶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#信息收集"><span class="nav-number">4.1.</span> <span class="nav-text">信息收集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#功能模块"><span class="nav-number">4.2.</span> <span class="nav-text">功能模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#提升"><span class="nav-number">4.3.</span> <span class="nav-text">提升</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#云扫描"><span class="nav-number">5.</span> <span class="nav-text">云扫描</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#企业安全扫描实践"><span class="nav-number">6.</span> <span class="nav-text">企业安全扫描实践</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防御"><span class="nav-number">7.</span> <span class="nav-text">防御</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">8.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Recar</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    

  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
















  
  









  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/affix.js?v=7.2.0"></script>

  <script src="/js/schemes/pisces.js?v=7.2.0"></script>




  
  <script src="/js/scrollspy.js?v=7.2.0"></script>
<script src="/js/post-details.js?v=7.2.0"></script>



  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  


  


























<script>
// GET RESPONSIVE HEIGHT PASSED FROM IFRAME

window.addEventListener("message", function(e) {
  var data = e.data;
  if ((typeof data === 'string') && (data.indexOf('ciu_embed') > -1)) {
    var featureID = data.split(':')[1];
    var height = data.split(':')[2];
    $(`iframe[data-feature=${featureID}]`).height(parseInt(height) + 30);
  }
}, false);
</script>








  

</body>
</html>
